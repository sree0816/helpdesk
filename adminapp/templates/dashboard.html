
<!DOCTYPE html>
{% extends "homeadmin.html" %}
{% load static %}
{% block content %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; }
        h1 { margin-bottom: 20px; color: #333; }
        .kpi-container { display: flex; gap: 20px; margin-bottom: 40px; flex-wrap: wrap; }
        .kpi-box {
            flex: 1;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .charts { display: flex; gap: 40px; flex-wrap: wrap; justify-content: space-around; }
        canvas { background: #fff; padding: 10px; border-radius: 10px; width: 100%; max-width: 500px; }
        .no-data { color: gray; font-style: italic; }
    </style>
</head>
<body>

<h1>Admin Dashboard</h1>

<div class="kpi-container">
    <div class="kpi-box">
        <h3>Total Tickets</h3>
        <p>{{ total_tickets }}</p>
    </div>
    <div class="kpi-box">
        <h3>Open Tickets</h3>
        <p>{{ open_tickets }}</p>
    </div>
    <div class="kpi-box">
        <h3>Closed Tickets</h3>
        <p>{{ closed_tickets }}</p>
    </div>
    <div class="kpi-box">
        <h3>Pending Tickets</h3>
        <p>{{ pending_tickets }}</p>
    </div>
    <div class="kpi-box" style="background:#ffe5e5;">
        <h3>SLA Breached Tickets</h3>
        <p style="color:red; font-weight:bold;">{{ sla_breached_tickets }}</p>
    </div>
</div>

{% if avg_resolution_time %}
<p><strong>Average Resolution Time:</strong> {{ avg_resolution_time }}</p>
{% endif %}

<div class="charts">
    <div>
        <h3>Tickets by Status</h3>
        <canvas id="statusChart"></canvas>
    </div>

    <div>
        <h3>Tickets Closed per Agent</h3>
        <canvas id="agentChart"></canvas>
    </div>
</div>

<script>
    const statuses = {{ status_counts_json|safe }};
    const agents = {{ agent_performance_json|safe }};

    // ---- Ticket Status Chart ----
    const statusLabels = statuses.map(item => item.status);
    const statusCounts = statuses.map(item => item.count);

    if (statusLabels.length > 0) {
        new Chart(document.getElementById('statusChart'), {
            type: 'pie',
            data: {
                labels: statusLabels,
                datasets: [{
                    data: statusCounts,
                    backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4CAF50', '#9C27B0']
                }]
            },
            options: {
                plugins: {
                    title: { display: true, text: 'Ticket Status Distribution' }
                }
            }
        });
    } else {
        document.getElementById('statusChart').insertAdjacentHTML('beforebegin',
            '<p class="no-data">No ticket data available.</p>');
    }

    // ---- Agent Performance Chart ----
    const agentNames = agents.map(a => a.name);
    const closedCounts = agents.map(a => a.closed_count);

    if (agentNames.length > 0) {
        new Chart(document.getElementById('agentChart'), {
            type: 'bar',
            data: {
                labels: agentNames,
                datasets: [{
                    label: 'Tickets Closed',
                    data: closedCounts,
                    backgroundColor: '#4CAF50'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Tickets Closed per Agent' }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Tickets' } },
                    x: { title: { display: true, text: 'Agent' } }
                }
            }
        });
    } else {
        document.getElementById('agentChart').insertAdjacentHTML('beforebegin',
            '<p class="no-data">No closed tickets yet.</p>');
    }
</script>

</body>
</html>
{% endblock %}
